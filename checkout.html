<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</title>

<style>
body{
  font-family: Arial;
  background:#f7f7f7;
}
.container{
  max-width:500px;
  margin:30px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
}
label{font-weight:bold;margin-top:10px;display:block}
input,textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid #ccc;
}
input.error, textarea.error{
  border:2px solid red;
}
.row{
  display:flex;
  gap:10px;
}
.row input{
  flex:1;
}
.summary{
  background:#f1f1f1;
  padding:10px;
  border-radius:8px;
  margin-top:15px;
}
.btn{
  width:100%;
  padding:15px;
  background:#25D366;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
  margin-top:20px;
  cursor:pointer;
}
.payment-box{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.payment-btn{
  flex:1;
  padding:12px;
  border:1px solid #ccc;
  border-radius:8px;
  text-align:center;
  cursor:pointer;
}
.payment-btn.active{
  background:#25D366;
  color:#fff;
  border-color:#25D366;
}
.note{
  color:red;
  font-size:13px;
  margin-top:8px;
  display:none;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ›’ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h2>

<label>Ø§Ù„Ø§Ø³Ù… *</label>
<input id="name">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
<input id="phone" inputmode="numeric" maxlength="11">

<label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø± *</label>
<input id="property" placeholder="Ø´Ù‚Ø© / ÙÙŠÙ„Ø§">

<label>Ø§Ù„Ø­ÙŠ *</label>
<input id="district">

<label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label>
<input id="area">

<label>Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ *</label>
<input id="street">

<div class="row">
  <input id="building" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ *">
  <input id="floor" placeholder="Ø§Ù„Ø¯ÙˆØ± *">
  <input id="apartment" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø© *">
</div>

<label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„ *</label>
<textarea id="address" rows="3"></textarea>

<label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
<div class="payment-box">
  <div class="payment-btn" onclick="selectPayment('ÙƒØ§Ø´', this)">ğŸ’µ ÙƒØ§Ø´</div>
  <div class="payment-btn" onclick="selectPayment('Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ', this)">ğŸ’³ Instapay</div>
</div>

<div id="instaNote" class="note">
Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹ ğŸ“¸
</div>

<label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
<textarea id="notes" rows="2"></textarea>

<div class="summary">
<strong>ğŸ“¦ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨:</strong>
<div id="orderSummary"></div>
<hr>
<strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> <span id="totalPrice">0</span> Ø¬Ù†ÙŠÙ‡
</div>

<button class="btn" onclick="sendOrder()">ğŸ“² Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<script>
/* ===== Ø§Ù„Ø³Ù„Ø© ===== */
const cart = JSON.parse(localStorage.getItem("cart")) || [];
const summary = document.getElementById("orderSummary");
const totalEl = document.getElementById("totalPrice");

let total = 0;
summary.innerHTML = "";

cart.forEach(item=>{
  let itemTotal = item.unit
    ? item.price * item.quantity
    : (item.price * item.quantity)/1000;

  total += itemTotal;

  summary.innerHTML += `
    <div>${item.product} Ã— ${item.quantity} = ${itemTotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
  `;
});

totalEl.textContent = total.toFixed(2);

/* ===== Ø§Ù„Ø¯ÙØ¹ ===== */
let paymentMethod = "";

function selectPayment(method, el){
  paymentMethod = method;
  document.querySelectorAll(".payment-btn").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  document.getElementById("instaNote").style.display =
    method === "Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ" ? "block" : "none";
}

/* ===== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ===== */
function sendOrder(){

  const customerName = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();

  const fields = [
    "name","phone","property","district","area",
    "street","building","floor","apartment","address"
  ];

  let valid = true;
  fields.forEach(id=>{
    const el = document.getElementById(id);
    el.classList.remove("error");
    if(!el.value.trim()){
      el.classList.add("error");
      valid = false;
    }
  });

  if(!valid){
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
    return;
  }

  if(!/^\d{11}$/.test(phone)){
    document.getElementById("phone").classList.add("error");
    alert("Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ§Ù„Ø­");
    return;
  }

  if(!paymentMethod){
    alert("Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹");
    return;
  }

  /* ===== Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ===== */
  let message = `ğŸŒ™ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸŒ™\n\n`;
  message += `Ø§Ù„Ø§Ø³Ù…: ${customerName}\n`;
  message += `Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n`;
  message += `Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${property.value}\n`;
  message += `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${district.value} - ${area.value} - ${street.value}\n`;
  message += `Ù…Ø¨Ù†Ù‰: ${building.value} - Ø¯ÙˆØ±: ${floor.value} - Ø´Ù‚Ø©: ${apartment.value}\n`;
  message += `Ø§Ù„Ø¯ÙØ¹: ${paymentMethod}\n\nğŸ“¦ Ø§Ù„Ø·Ù„Ø¨:\n`;

  cart.forEach(item=>{
    let itemTotal = item.unit
      ? item.price * item.quantity
      : (item.price * item.quantity)/1000;
    message += `- ${item.product} Ã— ${item.quantity} = ${itemTotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡\n`;
  });

  message += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¬Ù†ÙŠÙ‡`;
  if(notes.value) message += `\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes.value}`;

  /* ===== Google Sheet ===== */
  fetch("https://script.google.com/macros/s/AKfycbxdfPXKl6aWP_aB7ZLTwuv3HLzRkPCVHErZmGBEokXZshaLZYMsxrnyJh5eGhI66kZ_",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      name: customerName,
      phone: phone,
      property: property.value,
      district: district.value,
      area: area.value,
      street: street.value,
      building: building.value,
      floor: floor.value,
      apartment: apartment.value,
      payment: paymentMethod,
      notes: notes.value,
      order: cart.map(i=>`${i.product} Ã— ${i.quantity}`).join(" | "),
      total: total
    })
  });

  /* ===== ÙˆØ§ØªØ³Ø§Ø¨ ===== */
  window.open(
    "https://wa.me/201207772789?text=" + encodeURIComponent(message),
    "_blank"
  );
}
</script>

</body>
</html>
